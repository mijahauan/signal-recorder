# GRAPE Signal Recorder Configuration
# Generated by GRAPE Configuration UI
# Station: AC0G-BEE1

[station]
callsign = "AC0G"
grid_square = "EM38ww40pk"
id = "S000171"
instrument_id = "172"
description = "beelink rx888 SAS"

# Precise coordinates for improved timing accuracy (~16Î¼s improvement)
latitude = 38.918461   # Decimal degrees, positive = North
longitude = -92.127974 # Decimal degrees, negative = West

[ka9q]
status_address = "bee1-hf-status.local"
# data_destination is optional - if not specified, radiod uses its default
# data_destination = "bee1-hf-data.local"
auto_create_channels = true

[recorder]
# Mode: "test" or "production"
# - test: Uses temporary directory, safe for development
# - production: Uses permanent directory for operational data
mode = "test"

# Data root paths by mode
test_data_root = "/tmp/grape-test"
production_data_root = "/var/lib/signal-recorder"

# Directory structure - THREE-PHASE PIPELINE:
# CRITICAL: All code MUST use centralized GRAPEPaths API:
#   - Python: src/grape_recorder/paths.py
#
# ${data_root}/
#   raw_archive/{CHANNEL}/{YYYYMMDD}/                - PHASE 1: Immutable DRF archive
#     {YYYY-MM-DDTHH}/rf@{timestamp}.h5              - 20 kHz complex64 IQ
#     metadata/                                       - NTP status, gaps, provenance
#
#   phase2/{CHANNEL}/                                - PHASE 2: Analytical engine
#     clock_offset/                                   - D_clock(t) time series
#     carrier_analysis/                               - Amplitude, phase, Doppler
#     channel_quality/                                - Delay spread, coherence
#     discrimination/                                 - WWV/WWVH per-minute
#     bcd_correlation/                                - 100 Hz BCD analysis
#     ground_truth/                                   - 440/500/600 Hz station ID
#
#   products/{CHANNEL}/                              - PHASE 3: Derived products
#     decimated/                                      - 10 Hz DRF time series
#     spectrograms/                                   - PNG images
#     psws_upload/                                    - PSWS format files
#
#   state/                                           - Global state
#   status/                                          - System status

recording_interval = 60
continuous = true

# RTP packet timing (from radiod)
# blocktime_ms controls samples per RTP packet: samples_per_packet = sample_rate * blocktime_ms / 1000
# radiod IQ mode uses 8ms blocktime, giving 160 samples/packet at 20 kHz
blocktime_ms = 8

# Maximum gap to fill with zeros (seconds)
# Gaps larger than this indicate stream restart or corruption
max_gap_seconds = 60

# Storage quota - total allocation for ALL channels (FIFO cleanup)
# Specify as:
#   - Fixed size: "500GB", "1TB", "200GB"
#   - Percentage of disk: "80%", "50%"
#   - "unlimited" or omit for no limit
storage_quota = "80%"

# Default parameters for all channels (can be overridden per-channel)
[recorder.channel_defaults]
preset = "iq"
sample_rate = 20000
agc = 0
gain = 0

# Channel definitions - SSRC auto-allocated by ka9q-python
# Only frequency_hz and description required; defaults applied automatically

[[recorder.channels]]
frequency_hz = 2500000
description = "WWV 2.5 MHz"

[[recorder.channels]]
frequency_hz = 5000000
description = "WWV 5 MHz"

[[recorder.channels]]
frequency_hz = 10000000
description = "WWV 10 MHz"

[[recorder.channels]]
frequency_hz = 15000000
description = "WWV 15 MHz"

[[recorder.channels]]
frequency_hz = 20000000
description = "WWV 20 MHz"

[[recorder.channels]]
frequency_hz = 25000000
description = "WWV 25 MHz"

[[recorder.channels]]
frequency_hz = 3330000
description = "CHU 3.33 MHz"

[[recorder.channels]]
frequency_hz = 7850000
description = "CHU 7.85 MHz"

[[recorder.channels]]
frequency_hz = 14670000
description = "CHU 14.67 MHz"

[uploader]
enabled = false  # Set to true when PSWS account is verified and SSH key installed
protocol = "sftp"  # PSWS requires SFTP
upload_time = "00:30"
upload_timezone = "UTC"
max_retries = 5
retry_delay_seconds = 300
exponential_backoff = true
# queue_dir is auto-managed based on mode (test vs production)
# Test mode: /tmp/grape-test/upload
# Production mode: /var/lib/signal-recorder/upload
max_queue_size_gb = 100

[uploader.sftp]
host = "pswsnetwork.eng.ua.edu"
port = 22
user = "S000171"  # Station ID from [station.id]
ssh_key = "/home/wsprdaemon/.ssh/id_rsa"
remote_base_path = "/"  # PSWS requires upload to home directory
bandwidth_limit_kbps = 0  # 0 = unlimited; set non-zero for ISP-imposed bandwidth constraints
verify_after_upload = true
delete_after_upload = false
create_trigger_directory = true  # CRITICAL: Signals PSWS to process data

[uploader.metadata]
# Extended metadata includes timing quality and gap analysis from 16 kHz source
# When false: wsprdaemon-compatible minimal metadata only
# When true: adds time_snap calibration data, gap analysis, timing quality metrics
include_extended_metadata = false

[logging]
level = "DEBUG"
console_output = true
file_output = true

[monitoring]
enable_metrics = true  # Enable real-time quality monitoring

[web_ui]
# Web-UI automatically reads from recorder.data_root
port = 3000
# API refresh interval (seconds)
refresh_interval = 60
