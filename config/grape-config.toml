# GRAPE Signal Recorder Configuration
# Generated by GRAPE Configuration UI
# Station: AC0G-BEE1

[station]
callsign = "AC0G"
grid_square = "EM38ww"
id = "S000171"
instrument_id = "172"
description = "beelink rx888 SAS"

[ka9q]
status_address = "bee1-hf-status.local"
# data_address will be auto-discovered from radiod via status_address
# Uncomment to override: data_address = "239.103.26.231"
auto_create_channels = true

[recorder]
# Mode: "test" or "production"
# - test: Uses temporary directory, safe for development
# - production: Uses permanent directory for operational data
mode = "test"

# Data root paths by mode
test_data_root = "/tmp/grape-test"
production_data_root = "/var/lib/signal-recorder"

# Directory structure (auto-created based on mode):
# CRITICAL: All code MUST use centralized GRAPEPaths API:
#   - Python:     src/signal_recorder/paths.py
#   - JavaScript: web-ui/grape-paths.js
#   - Protocol:   WEB_UI_ANALYTICS_SYNC_PROTOCOL.md
#
# ${data_root}/
#   archives/{CHANNEL}/                              - Raw 16 kHz NPZ files
#   analytics/{CHANNEL}/
#     decimated/                                     - 10 Hz NPZ files (pre-DRF)
#     digital_rf/{YYYYMMDD}/.../{CHANNEL}/*.h5       - 10 Hz Digital RF files
#     discrimination/                                - WWV/WWVH analysis CSVs
#     quality/                                       - Quality metrics CSVs
#     logs/                                          - Processing logs
#     status/                                        - Runtime status
#   spectrograms/{YYYYMMDD}/*.png                    - Web UI spectrograms
#   state/analytics-{channel_key}.json               - Service state
#   status/analytics-service-status.json             - System status

recording_interval = 60
continuous = true

[[recorder.channels]]
ssrc = 2500000
frequency_hz = 2500000
preset = "iq"
sample_rate = 16000
agc = 0
gain = 0
description = "WWV 2.5 MHz"
enabled = true
processor = "grape"

[[recorder.channels]]
ssrc = 5000000
frequency_hz = 5000000
preset = "iq"
sample_rate = 16000
agc = 0
gain = 0
description = "WWV 5 MHz"
enabled = true
processor = "grape"

[[recorder.channels]]
ssrc = 10000000
frequency_hz = 10000000
preset = "iq"
sample_rate = 16000
agc = 0
gain = 0
description = "WWV 10 MHz"
enabled = true
processor = "grape"

[[recorder.channels]]
ssrc = 15000000
frequency_hz = 15000000
preset = "iq"
sample_rate = 16000
agc = 0
gain = 0
description = "WWV 15 MHz"
enabled = true
processor = "grape"

[[recorder.channels]]
ssrc = 20000000
frequency_hz = 20000000
preset = "iq"
sample_rate = 16000
agc = 0
gain = 0
description = "WWV 20 MHz"
enabled = true
processor = "grape"

[[recorder.channels]]
ssrc = 25000000
frequency_hz = 25000000
preset = "iq"
sample_rate = 16000
agc = 0
gain = 0
description = "WWV 25 MHz"
enabled = true
processor = "grape"

[[recorder.channels]]
ssrc = 3330000
frequency_hz = 3330000
preset = "iq"
sample_rate = 16000
agc = 0
gain = 0
description = "CHU 3.33 MHz"
enabled = true
processor = "grape"

[[recorder.channels]]
ssrc = 7850000
frequency_hz = 7850000
preset = "iq"
sample_rate = 16000
agc = 0
gain = 0
description = "CHU 7.85 MHz"
enabled = true
processor = "grape"

[[recorder.channels]]
ssrc = 14670000
frequency_hz = 14670000
preset = "iq"
sample_rate = 16000
agc = 0
gain = 0
description = "CHU 14.67 MHz"
enabled = true
processor = "grape"

# ============================================================================
# OBSOLETE SECTIONS (V1 Legacy - Not Used by V2 Recorder)
# ============================================================================
# The V2 GRAPE recorder performs inline processing and Digital RF writing.
# These settings are ignored. Kept for reference only.

# [processor]
# enabled = false

# [processor.grape]
# process_time = "00:05"
# process_timezone = "UTC"
# expected_files_per_day = 1440
# max_gap_minutes = 5
# repair_gaps = true
# interpolate_max_minutes = 2
# output_sample_rate = 10
# output_format = "digital_rf"

# ============================================================================
# Upload Configuration (Not Yet Implemented)
# ============================================================================
# Upload functionality exists but needs configuration fixes before enabling.
# See GRAPE_UPLOAD_IMPLEMENTATION.md for required changes:
#   - Change protocol from "rsync" to "sftp"
#   - Fix user, ssh_key, remote_base_path
#   - Add trigger directory creation

[uploader]
enabled = false  # Set to true when PSWS account is verified and SSH key installed
protocol = "sftp"  # PSWS requires SFTP
upload_time = "00:30"
upload_timezone = "UTC"
max_retries = 5
retry_delay_seconds = 300
exponential_backoff = true
# queue_dir is auto-managed based on mode (test vs production)
# Test mode: /tmp/grape-test/upload
# Production mode: /var/lib/signal-recorder/upload
max_queue_size_gb = 100

[uploader.sftp]
host = "pswsnetwork.eng.ua.edu"
port = 22
user = "S000171"  # Station ID from [station.id]
ssh_key = "/home/mjh/.ssh/id_ed25519"
remote_base_path = "/"  # PSWS requires upload to home directory
bandwidth_limit_kbps = 100  # 100 kbps per wsprdaemon
verify_after_upload = true
delete_after_upload = false
create_trigger_directory = true  # CRITICAL: Signals PSWS to process data

[logging]
level = "DEBUG"
console_output = true
file_output = true

[monitoring]
enable_metrics = true  # Enable real-time quality monitoring

[web_ui]
# Web-UI automatically reads from recorder.data_root
port = 3000
# API refresh interval (seconds)
refresh_interval = 60
