# GRAPE Configuration UI

**Lightweight JSON-based configuration interface for the GRAPE signal recorder.**

## âœ¨ Features

- **No Database Required** - Uses simple JSON files for storage
- **Zero Configuration** - Works out of the box with default admin/admin login
- **TOML Export** - Generate configuration files compatible with signal-recorder
- **Channel Presets** - One-click setup for WWV and CHU frequencies
- **Simple Installation** - Single command to start

## ğŸš€ Quick Start

### Installation

1. **Install pnpm** (recommended, faster than npm):
   ```bash
   # On Ubuntu/Debian/macOS
   curl -fsSL https://get.pnpm.io/install.js | sh -

   # Alternative: npm (if pnpm not available)
   curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
   sudo apt install -y nodejs npm
   ```

2. **Clone and start**:
   ```bash
   cd web-ui
   pnpm install
   pnpm start

   # Alternative with npm:
   # npm install
   # npm start
   ```

3. **Access the interface**:
   - Open http://localhost:3000
   - Login with: `admin` / `admin`

## ğŸ”§ Usage

1. **Login** with default credentials (admin/admin)
2. **Create Configuration** - Fill in station details
3. **Add Channels** - Use presets or add custom frequencies
4. **Export TOML** - Download configuration file
5. **Copy to signal-recorder** config directory

## ğŸ—‚ï¸ Project Structure

```
web-ui/
â”œâ”€â”€ index.html          # Main web interface
â”œâ”€â”€ simple-server.js    # Express server with JSON API
â”œâ”€â”€ data/              # JSON database files (created automatically)
â”‚   â”œâ”€â”€ users.json
â”‚   â”œâ”€â”€ configurations.json
â”‚   â””â”€â”€ channels.json
â””â”€â”€ package.json
```

## ğŸ”’ Security

- **Default Credentials**: admin/admin (change in production)
- **Local Access**: Designed for local network use
- **No External Dependencies**: All data stored locally

## ğŸ› ï¸ Development

### Available Commands

```bash
pnpm start    # Start the server
pnpm run dev  # Same as start (development mode)
pnpm run format # Format code with Prettier

# Alternative with npm:
# npm start
# npm run dev
# npm run format
```

### Adding Features

The server provides a REST API:

- `GET /api/configurations` - List all configurations
- `POST /api/configurations` - Create new configuration
- `GET /api/configurations/:id/export` - Export TOML file
- `GET /api/presets/wwv` - WWV frequency presets
- `GET /api/presets/chu` - CHU frequency presets

## ğŸ“Š Database Schema

Configurations are stored as JSON with this structure:

```json
{
  "id": "unique-id",
  "name": "My Station",
  "callsign": "W1AW",
  "gridSquare": "EM10",
  "stationId": "station_001",
  "instrumentId": "instrument_001",
  "description": "Primary monitoring station",
  "dataDir": "/data/grape",
  "archiveDir": "/archive/grape",
  "pswsEnabled": "yes",
  "pswsServer": "pswsnetwork.eng.ua.edu",
  "createdAt": "2025-01-20T10:30:00.000Z",
  "updatedAt": "2025-01-20T10:30:00.000Z"
}
```

## âœ… **Direct RTP + Scipy Implementation**

The signal-recorder now uses **direct RTP reception with scipy-based resampling** instead of the external pcmrecord tool:

**Previous (pcmrecord-based):**
- External pcmrecord dependency
- File-based processing pipeline
- Multiple intermediate steps

**Current (scipy-based):**
- âœ… **Direct RTP packet reception** - No external tools
- âœ… **Scipy resampling** - High-quality 12kHz â†’ 10Hz decimation with anti-aliasing
- âœ… **Real-time processing** - Immediate Digital RF output
- âœ… **Integrated channel management** - Auto-creates radiod channels

### **Technical Implementation:**
- **RTP Reception**: Direct multicast socket with RTP header parsing
- **Resampling**: scipy.signal with 8th-order Butterworth anti-aliasing filter
- **Output**: Digital RF format with UTC-aligned timestamps
- **Channel Management**: Automatic radiod channel creation via control utility

### **Generated TOML Structure**
```toml
# GRAPE Signal Recorder Configuration
# Generated by GRAPE Configuration UI

[station]
callsign = "W1AW"
grid_square = "EM10"
id = "station_001"
instrument_id = "instrument_001"
description = "Primary monitoring station"

[ka9q]
status_address = "239.251.200.193"
auto_create_channels = true

[recorder]
data_dir = "/var/lib/signal-recorder/data"
archive_dir = "/var/lib/signal-recorder/archive"
recording_interval = 60
continuous = true

[[recorder.channels]]
ssrc = 10000000
frequency_hz = 10000000
preset = "iq"
sample_rate = 12000
description = "WWV 10 MHz"
enabled = true
processor = "grape"

[processor]
enabled = false

[processor.grape]
process_time = "00:05"
process_timezone = "UTC"
expected_files_per_day = 1440
output_sample_rate = 10
output_format = "digital_rf"

[uploader]
enabled = false
protocol = "rsync"
upload_time = "00:30"
# ... PSWS configuration when enabled

[logging]
level = "INFO"
console_output = true

[monitoring]
enable_metrics = false
```

## ğŸ“ **Save to Config Directory**

The web-ui can now **automatically save** TOML configurations directly to the signal-recorder's `config/` directory:

1. **Create/Edit** a configuration in the web interface
2. **Click "Save to Config Directory"** button
3. **TOML file** is written to `../config/grape-{station_id}.toml`
4. **Ready to use** with signal-recorder immediately

### **Alternative Options**
- **Export TOML**: Downloads file to browser's Downloads folder
- **Save to Config**: Writes directly to signal-recorder config directory

## ğŸš¨ Troubleshooting

### Server Won't Start
```bash
# Check if port 3000 is available
lsof -i :3000

# Or use a different port
PORT=8080 pnpm start

# Alternative with npm:
# PORT=8080 npm start
```

### Cannot Login
- Username: `admin`
- Password: `admin`
- Check browser console for errors

### Data Not Saving
- Ensure write permissions in the web-ui directory
- Check server logs for errors

## ğŸ”„ Migration from Complex Version

If you have the old version with MySQL/SQLite:

1. Export your configurations as TOML files
2. Delete the old installation
3. Use this simplified version
4. Import TOML files if needed (or recreate configurations)

## ğŸ“ License

Same as parent project (signal-recorder)

## ğŸ†˜ Support

- **Issues**: https://github.com/mijahauan/signal-recorder/issues
- **Documentation**: See parent repository README

---

**This simplified version prioritizes ease of use and reliability over complex features.**

